<!DOCTYPE html>

<html lang="zh-Hant-TW">

    <head>
        <title>Memo With Calendar</title>
        <link rel="stylesheet" type="text/css" href="../style/frame.css">
    </head>

    <body>
        <div>
            <h1>Memo With Calendar</h1>
        </div>
        <div>歡迎，<span id="username"></span>！</div>
        <div class="container">
            <div class="block_memo">
                memo block
            </div>
            <div class="block_calendar">
                <div class="calendar">
                    <div class="calendar_header">
                        <div class="year_picker">
                            <!-- 年份 -->
                        </div>
                        <div class="month_picker">
                            <span class="month_change" onclick="changeMonth(-1)"><</span>
                            <span class="month">
                                <!-- 月份 -->
                            </span>
                            <span class="month_change" onclick="changeMonth(1)">></span>
                        </div>
                    </div>
                    <div class="calendar_body">
                        <div class="calendar_week_day">
                            <div class="calendar_day">日</div>
                            <div class="calendar_day">一</div>
                            <div class="calendar_day">二</div>
                            <div class="calendar_day">三</div>
                            <div class="calendar_day">四</div>
                            <div class="calendar_day">五</div>
                            <div class="calendar_day">六</div>
                        </div>
                        <div class="calendar_days">
                            <!-- 日期 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            var Today, Year, Month, Day;
            var monthNames = ["一月", "二月", "三月", "四月", "五月", "六月",
                "七月", "八月", "九月", "十月", "十一月", "十二月"];
            window.onload = function() {
                // 設定使用者名稱
                fetch('/user_info')
                    .then(response => response.json())
                    .then(userInfo => {
                        document.getElementById('username').textContent = userInfo["given_name"];
                    });
                // 製作行事曆
                Today = new Date();
                year = Today.getFullYear();
                month = Today.getMonth()+1;
                day = Today.getDate();
                fetch('/calendar?year='+ year + '&month=' + month + '&day=' + day)
                    .then(response => response.text())
                    .then(calendarHtml => {
                        document.querySelector('.calendar_days').innerHTML = calendarHtml;
                    });
                    document.querySelector('.year_picker').textContent = year;
                    document.querySelector('.month').textContent = monthNames[month-1];
            };

            function changeMonth(count) {
                // count=1: 下個月, count=-1: 上個月
                month += count;
                if (month > 12) {
                    month = 1;
                    year += 1;
                } else if (month < 1) {
                    month = 12;
                    year -= 1;
                }
                fetch('/calendar?year='+ year + '&month=' + month + '&day=' + day)
                    .then(response => response.text())
                    .then(calendarHtml => {
                        document.querySelector('.calendar_days').innerHTML = calendarHtml;
                    });
                document.querySelector('.year_picker').textContent = year;
                document.querySelector('.month').textContent = monthNames[month-1];
            }

            function selectDay(){
                //取消之前選擇的日期的樣式
                var selected_day = document.querySelector(".selected_day");
                if(selected_day != null){
                    selected_day.classList.remove('selected_day');
                }
                
                // 改變被選擇日期的樣式
                var id = event.target.id;
                document.querySelector("#"+id).setAttribute('class', 'selected_day');
                
            }
        </script>
    </body>

</html>